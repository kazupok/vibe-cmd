# コードレビューコマンド

## 概要
プルリクエストのコードレビューを効率的に実行するためのAIアシスタント向けコマンド定義

## コマンド一覧

### 1. 包括的コードレビュー

#### `review_pull_request`
プルリクエストの包括的なレビューを実行する

**使用例:**
```
$review_pull_request$
```

**実行内容:**
1. 変更ファイルの分析
2. コード品質チェック
3. セキュリティ観点での確認
4. テストカバレッジの確認
5. ドキュメント更新の確認
6. 総合的なレビューコメント生成

**レビュー観点:**
```
1. 機能性
   - 要件通りの実装
   - エラーハンドリング
   - エッジケース対応
   - パフォーマンス影響

2. 保守性
   - コードの可読性
   - 命名規則遵守
   - 適切な抽象化
   - 結合度・凝集度

3. セキュリティ
   - 入力検証
   - 認証・認可
   - データ保護
   - 脆弱性チェック

4. テスト
   - ユニットテスト追加
   - テストカバレッジ
   - テスト品質
   - 統合テスト考慮
```

### 2. 特定観点レビュー

#### `review_security`
セキュリティ観点に特化したレビューを実行する

**使用例:**
```
$review_security$
```

**実行内容:**
1. 認証・認可機能の確認
2. 入力検証の実装状況
3. SQLインジェクション対策
4. XSS対策の確認
5. 機密情報の露出チェック
6. セキュリティヘッダーの設定

**チェック項目:**
```markdown
## セキュリティチェックリスト

### 認証・認可
- [ ] 適切な認証方式の実装
- [ ] 権限チェックの実装
- [ ] セッション管理の安全性
- [ ] JWT設定の妥当性

### 入力検証
- [ ] 全ての入力に対する検証
- [ ] サニタイゼーション処理
- [ ] SQLインジェクション対策
- [ ] XSS対策の実装

### データ保護
- [ ] 機密情報の暗号化
- [ ] ログ出力での情報露出防止
- [ ] 環境変数での秘匿情報管理
- [ ] HTTPS通信の強制
```

#### `review_performance`
パフォーマンス観点に特化したレビューを実行する

**使用例:**
```
$review_performance$
```

**実行内容:**
1. データベースクエリの効率性
2. アルゴリズムの計算量
3. メモリ使用量の確認
4. キャッシュ戦略の評価
5. 非同期処理の適切性
6. バンドルサイズへの影響

**チェック項目:**
```markdown
## パフォーマンスチェックリスト

### データベース
- [ ] N+1問題の回避
- [ ] インデックスの適切な使用
- [ ] クエリの最適化
- [ ] ページネーションの実装

### フロントエンド
- [ ] バンドルサイズの影響
- [ ] 画像最適化
- [ ] レンダリング最適化
- [ ] キャッシュ戦略

### バックエンド
- [ ] アルゴリズムの効率性
- [ ] メモリリークの防止
- [ ] 並行処理の最適化
- [ ] API応答時間
```

### 3. 自動レビュー

#### `auto_review_checklist`
自動化可能なレビュー項目をチェックする

**使用例:**
```
$auto_review_checklist$
```

**実行内容:**
1. ESLint/Prettierルールの確認
2. TypeScript型エラーのチェック
3. テスト実行結果の確認
4. 依存関係の脆弱性チェック
5. コードカバレッジの測定
6. ドキュメント生成の確認

**自動チェック項目:**
```bash
# コード品質
npm run lint              # ESLint
npm run format:check      # Prettier
npm run type-check        # TypeScript

# テスト
npm run test              # ユニットテスト
npm run test:coverage     # カバレッジ
npm run test:e2e          # E2Eテスト

# セキュリティ
npm audit                 # 依存関係の脆弱性
npm run security-scan     # セキュリティスキャン

# ビルド
npm run build             # ビルド確認
npm run bundle-analyze    # バンドルサイズ分析
```

### 4. レビューコメント生成

#### `generate_review_comments`
建設的なレビューコメントを生成する

**使用例:**
```
$generate_review_comments$
```

**実行内容:**
1. 指摘事項の重要度分類
2. 具体的な改善提案の作成
3. コード例の提示
4. 参考リンクの添付
5. 学習機会の提供

**コメントテンプレート:**
```markdown
## Must: [必須修正項目]
**問題**: [具体的な問題の説明]

**現在のコード:**
\`\`\`typescript
// 問題のあるコード例
\`\`\`

**提案:**
\`\`\`typescript
// 改善されたコード例
\`\`\`

**理由**: [修正が必要な理由の説明]
**参考**: [関連ドキュメントやベストプラクティスのリンク]

---

## Consider: [検討提案項目]
**提案**: [改善提案の内容]

**メリット**: [改善することの利点]
**参考**: [参考情報やアプローチ]

---

## Nit: [軽微な指摘]
**指摘**: [軽微な改善点]
**提案**: [簡単な修正方法]
```

### 5. レビュー品質評価

#### `evaluate_review_quality`
実施されたレビューの品質を評価する

**使用例:**
```
$evaluate_review_quality$
```

**実行内容:**
1. レビューカバレッジの測定
2. 指摘事項の適切性評価
3. フィードバックの建設性確認
4. レスポンス時間の分析
5. 改善提案の生成

**評価指標:**
```markdown
## レビュー品質スコア

### カバレッジ (40%)
- [ ] 全変更ファイルのレビュー実施
- [ ] 主要な観点（機能・品質・セキュリティ）の確認
- [ ] テストレビューの実施

### 品質 (30%)
- [ ] 具体的で実行可能な指摘
- [ ] 建設的なフィードバック
- [ ] 適切な重要度分類

### タイムリーネス (20%)
- [ ] 24時間以内の初回レスポンス
- [ ] 適切なレビュー期間
- [ ] ブロッキング要因の早期解決

### 教育的価値 (10%)
- [ ] 学習機会の提供
- [ ] ベストプラクティスの共有
- [ ] 参考情報の提示
```

## レビューワークフロー

### 1. レビュー開始前
```markdown
## 事前確認チェックリスト
- [ ] PR説明の確認
- [ ] CI/CDの通過確認
- [ ] 関連Issue/要件の理解
- [ ] 変更規模の把握
```

### 2. レビュー実施中
```markdown
## レビュー実施手順
1. **概要把握** - PR全体の目的と変更内容の理解
2. **機能確認** - 要件通りの実装かチェック
3. **コード品質** - 可読性・保守性の確認
4. **テスト確認** - テストの妥当性と網羅性
5. **セキュリティ** - セキュリティリスクの評価
6. **パフォーマンス** - 性能への影響確認
```

### 3. レビュー完了後
```markdown
## フォローアップ
- [ ] 指摘事項の対応確認
- [ ] 再レビューの実施
- [ ] 学んだことの共有
- [ ] プロセス改善の提案
```

## 効率化Tips

### レビュー優先順位
1. **Critical**: セキュリティ・本番障害リスク
2. **High**: 機能要件・アーキテクチャ影響
3. **Medium**: コード品質・保守性
4. **Low**: スタイル・ドキュメント

### 時間配分目安
- **小規模PR（~100行）**: 15-30分
- **中規模PR（100-400行）**: 30-60分
- **大規模PR（400行~）**: 分割を推奨

### 効果的なレビュー
```markdown
## Good Practice
✅ 具体的な改善提案
✅ コード例の提示
✅ 学習リソースの共有
✅ 前向きなトーン

## Avoid
❌ 抽象的な指摘
❌ 否定的なコメント
❌ 個人攻撃
❌ 重箱の隅つつき
```