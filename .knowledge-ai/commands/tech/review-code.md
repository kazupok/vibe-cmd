# コードレビューコマンド

## コマンド: `review_code`

### 目的
プルリクエストのコードレビューを体系的に実施し、品質向上と知識共有を促進する

### 実行内容
1. 変更内容の理解・分析
2. コード品質の評価
3. セキュリティ観点のチェック
4. 建設的なフィードバック提供
5. 改善提案の生成

### 使用タイミング
- プルリクエスト作成時
- コードレビュー依頼時
- マージ前の最終確認時

### レビュー観点

#### 1. 機能性チェック
```markdown
## 機能要件
- [ ] 要件通りに実装されている
- [ ] エッジケースが考慮されている
- [ ] エラーハンドリングが適切
- [ ] パフォーマンスに問題がない
- [ ] 既存機能への影響がない

## ビジネスロジック
- [ ] ドメインルールが正しく実装されている
- [ ] データの整合性が保たれている
- [ ] バリデーションが適切
- [ ] トランザクション境界が正しい
```

#### 2. コード品質チェック
```markdown
## 可読性
- [ ] 変数・関数名が分かりやすい
- [ ] コメントが適切（過不足ない）
- [ ] コードの意図が明確
- [ ] 複雑な処理が適切に分割されている

## 保守性
- [ ] 関数・クラスのサイズが適切
- [ ] 責任が適切に分離されている
- [ ] 重複コードがない
- [ ] 依存関係が整理されている

## 拡張性
- [ ] 将来の変更に対応しやすい設計
- [ ] 設定の外部化ができている
- [ ] インターフェースが適切に定義されている
```

#### 3. セキュリティチェック
```markdown
## 入力検証
- [ ] ユーザー入力のサニタイゼーション
- [ ] SQLインジェクション対策
- [ ] XSS対策
- [ ] CSRFトークンの実装

## 認証・認可
- [ ] 適切な権限チェック
- [ ] セッション管理の安全性
- [ ] パスワード処理の安全性
- [ ] APIキーの適切な管理

## データ保護
- [ ] 機密情報の暗号化
- [ ] ログ出力での情報漏洩防止
- [ ] 適切なHTTPヘッダー設定
```

### レビューコメント例

#### 良いフィードバック例
```markdown
**Must**: セキュリティの観点で修正が必要です

**問題**: ユーザー入力がそのままSQLクエリに使用されています
```typescript
// 現在のコード
const query = `SELECT * FROM users WHERE id = ${userId}`;
```

**提案**: パラメータ化クエリを使用してください
```typescript
// 改善案
const query = 'SELECT * FROM users WHERE id = ?';
const result = await db.query(query, [userId]);
```

**理由**: SQLインジェクション攻撃を防ぐため
**参考**: [OWASP SQL Injection Prevention](https://owasp.org/www-community/attacks/SQL_Injection)
```

```markdown
**Consider**: 可読性向上の提案

**提案**: 複雑な条件式を関数に抽出してはいかがでしょうか
```typescript
// 現在のコード
if (user.age >= 18 && user.hasValidId && user.country === 'JP' && !user.isBanned) {
  // 処理
}

// 提案
if (isEligibleUser(user)) {
  // 処理
}

function isEligibleUser(user: User): boolean {
  return user.age >= 18 && 
         user.hasValidId && 
         user.country === 'JP' && 
         !user.isBanned;
}
```

**メリット**: 
- 条件の意図が明確になる
- テストしやすくなる
- 再利用可能になる
```

#### 避けるべきコメント例
```markdown
❌ 悪い例:
「このコードはダメです」
「なぜこんな書き方をしたのですか？」
「前のやり方の方が良かった」

✅ 良い例:
「この処理は○○の観点で改善の余地があります」
「□□の理由で、△△のアプローチを検討してはいかがでしょうか」
「参考までに、××という方法もあります」
```

### レビュープロセス

#### 1. 事前確認
```markdown
## PR作成者チェック
- [ ] CI/CDが通過している
- [ ] セルフレビュー完了
- [ ] テストが追加されている
- [ ] ドキュメントが更新されている

## レビュアー事前確認
- [ ] PR説明を理解した
- [ ] 関連Issueを確認した
- [ ] 変更規模を把握した
```

#### 2. レビュー実施
```markdown
## レビュー手順
1. **全体理解**: PRの目的と変更概要を把握
2. **設計確認**: アーキテクチャ・設計パターンの妥当性
3. **実装確認**: コード品質・ベストプラクティス
4. **テスト確認**: テストの網羅性・品質
5. **セキュリティ確認**: セキュリティリスクの評価
6. **文書確認**: ドキュメント・コメントの適切性
```

#### 3. フォローアップ
```markdown
## レビュー後
- [ ] 指摘事項への対応確認
- [ ] 再レビューの実施
- [ ] 学んだことの共有
- [ ] プロセス改善の提案
```

### レビュー品質指標

#### 効果的なレビューの特徴
- **建設的**: 改善につながる具体的な提案
- **教育的**: 理由と参考情報を提供
- **効率的**: 重要な問題に焦点を当てる
- **尊重的**: 相手の努力と意見を尊重

#### 測定指標
- レビュー完了時間: 24時間以内
- バグ検出率: レビューでの早期発見
- コメント品質: 建設的フィードバックの割合
- 知識共有効果: チーム全体のスキル向上

### ツール活用

#### 自動チェック項目
```bash
# コード品質
npm run lint              # ESLint
npm run format:check      # Prettier  
npm run type-check        # TypeScript

# テスト
npm run test              # ユニットテスト
npm run test:coverage     # カバレッジ

# セキュリティ
npm audit                 # 依存関係の脆弱性
npm run security-scan     # セキュリティスキャン
```

#### レビュー支援ツール
- GitHub/GitLab PR機能
- SonarQube: コード品質分析
- CodeClimate: 技術的負債の可視化
- Snyk: セキュリティ脆弱性検出

### 注意点
- 人格ではなくコードを評価
- 建設的な提案を心がける
- 完璧を求めすぎない
- 学習機会として活用
- チーム文化の醸成を重視