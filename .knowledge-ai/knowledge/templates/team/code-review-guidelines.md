# コードレビューガイドライン

## 概要
チーム内でのコードレビューの方針と具体的なチェック項目

## レビューの目的
1. **品質向上**: バグの早期発見とコード品質の維持
2. **知識共有**: チーム内での技術知識・ビジネス知識の共有
3. **標準化**: コーディング規約とベストプラクティスの徹底
4. **メンタリング**: 経験の浅いメンバーへの指導とサポート

## レビュー体制

### レビュアー選定
- **必須レビュアー**: 2名以上
- **技術リード**: 技術的な判断が必要な場合
- **ドメインエキスパート**: 業務ロジックに関わる変更
- **セキュリティ担当**: セキュリティに影響する変更

### レビュー優先度
1. **Critical**: セキュリティ・本番障害に関わる修正
2. **High**: 新機能・重要なリファクタリング
3. **Medium**: バグ修正・軽微な改善
4. **Low**: ドキュメント更新・設定変更

## レビューチェックリスト

### 1. 機能・仕様
- [ ] 要件定義通りに実装されている
- [ ] ビジネスロジックが正しい
- [ ] エラーハンドリングが適切
- [ ] パフォーマンスに問題がない
- [ ] セキュリティリスクがない

### 2. コード品質
- [ ] 可読性が高い（命名、構造）
- [ ] 保守性が考慮されている
- [ ] 再利用可能な設計になっている
- [ ] 適切な抽象化レベル
- [ ] SOLID原則に従っている

### 3. テスト
- [ ] ユニットテストが適切に追加されている
- [ ] テストケースが十分（正常系・異常系）
- [ ] テストが安定して通る
- [ ] カバレッジが基準を満たしている
- [ ] E2Eテストが必要な場合は追加されている

### 4. ドキュメント
- [ ] APIの変更時は仕様書が更新されている
- [ ] 複雑な処理にはコメントがある
- [ ] READMEやセットアップ手順が最新
- [ ] 変更理由が明確

## レビューコメントの書き方

### 建設的なフィードバック
```
❌ 悪い例:
「このコードはダメです」

✅ 良い例:
「この処理は複雑になっているので、関数に分割してはいかがでしょうか？
例：extractUserValidation() のような形で」
```

### 重要度の明示
- **Must**: 必ず修正が必要
- **Should**: 修正を強く推奨
- **Consider**: 検討してほしい
- **Nit**: 細かい指摘（修正は任意）

### 具体的な提案
```markdown
**Must**: セキュリティの観点で問題があります
現在のコード:
\`\`\`typescript
const query = `SELECT * FROM users WHERE id = ${userId}`;
\`\`\`

提案:
\`\`\`typescript
const query = 'SELECT * FROM users WHERE id = ?';
db.query(query, [userId]);
\`\`\`
SQLインジェクションを防ぐため、パラメータ化クエリを使用してください。
```

## レビュー実施のタイミング

### 作成者側
1. **セルフレビュー完了後**にプルリクエスト作成
2. **CI/CDが通過**してからレビュー依頼
3. **ドラフト状態**での早期フィードバック歓迎

### レビュアー側
- **24時間以内**の初回レスポンス
- **重要度に応じた**レビュー期限設定
- **ブロッキング要因**の優先的対応

## レビューツール活用

### GitHub/GitLab機能
```markdown
# プルリクエストテンプレート
## 変更内容
- [ ] 新機能追加
- [ ] バグ修正
- [ ] リファクタリング
- [ ] ドキュメント更新

## 影響範囲
- [ ] フロントエンド
- [ ] バックエンド
- [ ] データベース
- [ ] インフラ

## テスト
- [ ] ユニットテスト追加
- [ ] 統合テスト確認
- [ ] 手動テスト実施

## チェックリスト
- [ ] ESLintエラーなし
- [ ] TypeScriptエラーなし
- [ ] テスト通過
- [ ] ドキュメント更新
```

### 自動化ツール
- **SonarQube**: コード品質分析
- **CodeClimate**: 技術的負債の可視化
- **Snyk**: セキュリティ脆弱性検出
- **Lighthouse**: パフォーマンス測定

## 良いレビュー文化

### レビュアーの心得
1. **建設的**: 批判ではなく改善提案
2. **教育的**: 理由を説明し学習機会を提供
3. **効率的**: 重要な問題に焦点を当てる
4. **尊重**: 相手の努力と意見を尊重

### 作成者の心得
1. **オープン**: フィードバックを歓迎
2. **説明**: 設計判断の理由を明確に
3. **改善**: 指摘事項への真摯な対応
4. **感謝**: レビュアーの時間と労力に感謝

## レビュー効率化

### 小さなPR推奨
- **400行以下**を目安
- **単一の関心事**に集中
- **段階的な実装**でリスク軽減

### 事前準備
```markdown
## PR説明例
### 背景
ユーザー認証機能の実装が必要になりました。

### 変更内容
- JWT認証の実装
- ログイン/ログアウト機能
- パスワードハッシュ化

### 注意点
- セッション管理の仕組みが変更されます
- 既存のユーザーデータマイグレーションが必要です

### レビューで見てほしい点
- セキュリティ観点での実装確認
- パフォーマンスへの影響評価
```