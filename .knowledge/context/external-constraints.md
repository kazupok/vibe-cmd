# 外部制約

## Notion API制約

### レート制限
- **リクエスト数**: 3リクエスト/秒
- **バースト**: 短期間の高負荷は許容
- **対策**:
  ```typescript
  // レート制限を考慮した実装
  const rateLimiter = new RateLimiter({
    requestsPerSecond: 3,
    burst: 10
  });
  ```

### データ取得制限
- **ページサイズ**: 最大100件/リクエスト
- **プロパティ数**: 推奨25個以下
- **ネストレベル**: 最大2階層
- **対策**: ページネーション、必要なプロパティのみ取得

### API変更への対応
- **バージョニング**: Notion APIは頻繁に更新
- **非推奨期間**: 通常3-6ヶ月
- **対策**: 
  - API変更の監視
  - 抽象化層の実装
  - 段階的な移行計画

## 法規制・コンプライアンス

### GDPR（EU一般データ保護規則）
- **要件**:
  - ユーザーの明示的な同意
  - データポータビリティ
  - 忘れられる権利
  - データ処理の透明性

- **実装**:
  ```typescript
  interface GDPRCompliance {
    exportUserData(userId: string): Promise<UserDataExport>;
    deleteUserData(userId: string): Promise<void>;
    getConsentRecord(userId: string): Promise<ConsentRecord>;
  }
  ```

### 日本の個人情報保護法
- **要件**:
  - 利用目的の明示
  - 安全管理措置
  - 第三者提供の制限

### データレジデンシー
- **要件**: 特定地域でのデータ保存
- **対策**: 
  - マルチリージョン対応
  - データ保存場所の選択機能

## インフラストラクチャ制約

### クラウドプロバイダー
- **AWS/GCP制限**:
  - コンピューティング: vCPU制限
  - ストレージ: IOPS制限
  - ネットワーク: 帯域幅制限

### データベース制約
- **PostgreSQL**:
  - 接続数上限: 100（デフォルト）
  - クエリタイムアウト: 30秒
  - テーブルサイズ: 32TB
  
- **対策**:
  ```typescript
  // コネクションプーリング
  const pool = new Pool({
    max: 20,
    idleTimeoutMillis: 30000,
    connectionTimeoutMillis: 2000,
  });
  ```

### Redis制約
- **メモリ制限**: インスタンスサイズに依存
- **キー数制限**: なし（メモリ依存）
- **エビクションポリシー**: LRU推奨

## サードパーティサービス

### 決済システム（Stripe）
- **制約**:
  - API呼び出し: 100/秒
  - Webhook再送: 最大3回
  - データ保持: 最大90日

### メール送信（SendGrid）
- **制約**:
  - 送信レート: プランに依存
  - 添付ファイル: 最大30MB
  - バウンス率: 5%以下推奨

### ファイルストレージ（S3）
- **制約**:
  - オブジェクトサイズ: 最大5TB
  - リクエスト: 3,500 PUT/秒
  - バケット数: 100/アカウント

## ブラウザ・クライアント制約

### ブラウザサポート
- **対象ブラウザ**:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+

### モバイル制約
- **ネットワーク**: 低速接続を考慮
- **バッテリー**: 省電力実装
- **ストレージ**: 限定的なローカルストレージ

### パフォーマンス目標
- **初回読み込み**: < 3秒
- **インタラクション**: < 100ms
- **バンドルサイズ**: < 200KB（gzip）

## セキュリティ制約

### 暗号化要件
- **通信**: TLS 1.3必須
- **保存**: AES-256-GCM
- **ハッシュ**: Argon2（パスワード）

### 認証プロバイダー
- **OAuth2プロバイダー**:
  - Google: 標準準拠
  - GitHub: スコープ制限あり
  - Microsoft: テナント設定必要

### WAF（Web Application Firewall）
- **制限**:
  - リクエストサイズ: 最大8KB
  - URLパラメータ数: 最大100
  - カスタムルール: 最大100

## ライセンス制約

### オープンソースライセンス
- **使用可能**:
  - MIT
  - Apache 2.0
  - BSD
  
- **注意が必要**:
  - GPL: ソースコード開示義務
  - AGPL: ネットワーク使用も開示

### 商用ライセンス
- **フォント**: 商用利用可能なものを選択
- **アイコン**: ライセンス確認必須
- **画像・メディア**: 著作権クリアランス

## 運用制約

### SLA（Service Level Agreement）
- **目標可用性**: 99.9%
- **計画メンテナンス**: 月1回、最大2時間
- **緊急メンテナンス**: 必要に応じて

### バックアップ
- **頻度**: 
  - フルバックアップ: 日次
  - 増分バックアップ: 1時間ごと
- **保持期間**: 30日間
- **復旧時間目標（RTO）**: 4時間

### 災害復旧
- **RPO（目標復旧時点）**: 1時間
- **RTO（目標復旧時間）**: 4時間
- **定期訓練**: 四半期ごと

## 予算制約

### インフラコスト
- **月次予算**: $X,XXX
- **コスト配分**:
  - コンピューティング: 40%
  - ストレージ: 20%
  - ネットワーク: 20%
  - その他サービス: 20%

### 最適化戦略
```typescript
// コスト最適化の実装例
class CostOptimizer {
  // オートスケーリング設定
  async configureAutoScaling() {
    return {
      minInstances: 2,
      maxInstances: 10,
      targetCPU: 70,
      scaleDownDelay: 300
    };
  }

  // コールドスタート対策
  async warmupInstances() {
    // 定期的なヘルスチェックで温存
  }
}
```

## 対応戦略まとめ

1. **制約の監視**: 定期的な制約事項の確認
2. **バッファの確保**: 制限値の80%で警告
3. **フォールバック**: 制約到達時の代替処理
4. **ドキュメント化**: 制約と対策の文書化
5. **定期レビュー**: 四半期ごとの見直し