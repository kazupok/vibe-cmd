# タスク実装ワークフロー

## 概要

GitHub Issuesで管理されたタスクを実際に実装する際の標準的な手順を定義します。品質を保ちながら効率的に実装を進めるためのワークフローです。

## 前提条件

- GitHub Issueが作成済み
- 実装環境が構築済み
- 関連する仕様書を読み込み済み

## 必要な参考資料

### 🎯 タスク管理（必須）

- [`domain/versions/current.md`](../domain/versions/current.md) - 現在のドメイン全体図
- [`domain/実装計画.md`](../domain/実装計画.md) - 実装計画・優先度
- [GitHub Issues](https://github.com/kazupok/matercms/issues) - 詳細タスク仕様

### 🏗️ 実装指針（必須）

- [`knowledge/guidelines/開発フロー指針.md`](../knowledge/guidelines/開発フロー指針.md) - 開発プロセス・実装フロー
- [`knowledge/guidelines/コーディング規約.md`](../knowledge/guidelines/コーディング規約.md) - コーディング規約
- [`knowledge/guidelines/テスト指針.md`](../knowledge/guidelines/テスト指針.md) - テスト戦略

### 📋 仕様・設計（該当する場合）

- [`domain/business-rules.md`](../domain/business-rules.md) - ビジネスルール制約
- [`domain/terminology.md`](../domain/terminology.md) - 用語定義・ドメイン概念
- [`spec/アーキテクチャ.md`](../spec/アーキテクチャ.md) - システムアーキテクチャ

### 💡 実装パターン（該当する場合）

- [`knowledge/examples/エンティティ実装例.md`](../knowledge/examples/エンティティ実装例.md) - DDDエンティティ実装
- [`knowledge/examples/値オブジェクト実装例.md`](../knowledge/examples/値オブジェクト実装例.md) - 値オブジェクト実装
- [`knowledge/examples/リポジトリ実装例.md`](../knowledge/examples/リポジトリ実装例.md) - リポジトリパターン

## ワークフロー手順

### Phase 1: 実装準備 🎯

#### 1.1 GitHub Issue内容の確認

```markdown
確認事項：

- [ ] Issueの受け入れ条件を理解
- [ ] 技術仕様を確認
- [ ] 依存関係・前提条件をチェック
- [ ] ラベル・マイルストーンを確認
```

#### 1.2 ブランチ作成・環境準備

```bash
# ブランチ作成
git checkout develop
git pull origin develop
git checkout -b feature/issue-001-email-sending

# 作業環境確認
pnpm install
pnpm run check-types
pnpm run test
```

#### 1.3 実装開始の宣言

```markdown
実装開始時の更新：

1. GitHub Issueに担当者をアサイン
2. Issueのステータスを「In Progress」に変更
3. `domain/実装計画.md` の担当者・ステータス更新
4. 開始日時の記録
```

### Phase 2: 実装実行 🛠️

#### 2.1 設計・データモデル実装

**実装順序（推奨）:**

1. **データモデル定義** (Prismaスキーマ等)
2. **値オブジェクト実装** (バリデーション含む)
3. **エンティティ実装** (ビジネスロジック含む)
4. **ドメインサービス実装** (必要な場合)

**チェックポイント:**

```markdown
- [ ] データモデルが仕様通り定義されている
- [ ] 値オブジェクトが不変性を保証している
- [ ] エンティティがビジネスルールを適切にカプセル化
- [ ] 命名規則がコーディング規約に準拠
```

#### 2.2 アプリケーション層実装

**実装順序（推奨）:**

1. **リポジトリインターフェース定義**
2. **ユースケース/アプリケーションサービス実装**
3. **DTO・入出力定義**
4. **リポジトリ実装** (データアクセス層)

**チェックポイント:**

```markdown
- [ ] 依存性の逆転原則が適用されている
- [ ] ユースケースがドメインロジックのみを呼び出し
- [ ] 適切なエラーハンドリングが実装されている
- [ ] トランザクション境界が正しく設定されている
```

#### 2.3 プレゼンテーション層実装

**実装順序（推奨）:**

1. **APIエンドポイント定義**
2. **リクエスト・レスポンス変換**
3. **バリデーション実装**
4. **認証・認可の適用**

**チェックポイント:**

```markdown
- [ ] API仕様がAPI設計指針に準拠
- [ ] 適切なHTTPステータスコードを使用
- [ ] セキュリティ要件が満たされている
- [ ] エラーレスポンスが統一されている
```

### Phase 3: テスト実装 🧪

#### 3.1 単体テスト作成

```markdown
優先度順にテスト実装：

1. [ ] 値オブジェクトのテスト（バリデーション含む）
2. [ ] エンティティのテスト（ビジネスロジック含む）
3. [ ] ドメインサービスのテスト
4. [ ] ユースケースのテスト
```

#### 3.2 統合テスト作成

```markdown
統合テスト実装：

1. [ ] リポジトリ統合テスト（データベース連携）
2. [ ] APIエンドポイントテスト
3. [ ] 外部サービス連携テスト（該当する場合）
```

#### 3.3 テスト実行・カバレッジ確認

```bash
# テスト実行
pnpm run test
pnpm run test:integration

# カバレッジ確認
pnpm run test:coverage

# 品質チェック
pnpm run build
pnpm run lint
pnpm run check-types
```

### Phase 4: 完了処理 📝

#### 4.1 実装完了の確認

```markdown
完了条件チェック：

- [ ] 全ての受け入れ条件を満たしている
- [ ] テストカバレッジが80%以上
- [ ] コードレビューの準備が完了
- [ ] ドキュメントが更新されている
```

#### 4.2 ドメイン管理の更新

```markdown
1. `domain/versions/current.md` の更新：

   - 該当機能のチェックボックスを更新 ✅
   - リビジョン番号をインクリメント
   - 進捗サマリーを更新

2. `domain/実装計画.md` の更新：

   - タスクステータスを「完了」に変更
   - 次のタスクの優先度を見直し

3. GitHub Issueの更新：
   - Issueを「完了」としてClose
   - 実装完了コメントを追加
   - 気づき・課題をコメントに記録
```

#### 4.3 プルリクエスト作成

```bash
# 変更をコミット
git add .
git commit -m "feat: メール送信基礎実装

- SMTP設定管理機能を実装
- 基本的なメール送信APIを実装
- 送信履歴保存機能を実装
- 単体・統合テストを追加

Closes #1"

# プルリクエスト作成
git push origin feature/issue-001-email-sending
gh pr create --title "feat: メール送信基礎実装 (#1)" --body "$(cat <<'EOF'
## 概要
メール送信機能の基礎実装を行いました。

## 実装内容
- [x] SMTP設定管理機能
- [x] 基本的なメール送信API
- [x] 送信履歴保存機能
- [x] エラーハンドリング

## テスト
- [x] 単体テストカバレッジ: 85%
- [x] 統合テスト完了
- [x] 手動テスト完了

## 関連Issue
- Closes #1

🤖 Generated with [Claude Code](https://claude.ai/code)
EOF
)"
```

## チェックポイント

### ✅ Phase 1 完了チェック

- [ ] GitHub Issue内容を完全に理解している
- [ ] 必要な参考資料をすべて確認済み
- [ ] 実装環境が正常に動作している
- [ ] 担当者アサイン・ステータス更新が完了

### ✅ Phase 2 完了チェック

- [ ] すべての機能が仕様通り実装されている
- [ ] アーキテクチャ指針に準拠している
- [ ] コーディング規約に準拠している
- [ ] セキュリティ要件が満たされている

### ✅ Phase 3 完了チェック

- [ ] テストカバレッジが80%以上
- [ ] すべてのテストが成功している
- [ ] 品質チェックが通過している
- [ ] パフォーマンス要件を満たしている

### ✅ Phase 4 完了チェック

- [ ] ドメイン管理ファイルが更新されている
- [ ] GitHub Issueがクローズされている
- [ ] プルリクエストが作成されている
- [ ] 次のタスクの準備ができている

## トラブルシューティング

### よくある問題と対処法

#### 1. 受け入れ条件が曖昧な場合

```
解決策: domain/business-rules.md と domain/terminology.md を再確認
問い合わせ先: プロダクトオーナー・ビジネスアナリスト
GitHub Issue で質問コメントを追加
```

#### 2. 技術的実装方針で迷った場合

```
解決策:
- knowledge/guidelines/開発フロー指針.md - 開発プロセス・実装フロー
- spec/アーキテクチャ.md - システムアーキテクチャ
参考: knowledge/examples/ の類似実装
問い合わせ先: アーキテクト・テックリード
```

#### 3. Issue管理で困った場合

```
解決策:
- ラベルを適切に設定する
- マイルストーンで期限管理
- 関連Issueをリンクする
- 進捗コメントを定期的に更新
```

## 次のステップ

タスク実装完了後は以下のワークフローに移行：

- **コードレビュー**: [`knowledge/guidelines/レビューガイドライン.md`](../knowledge/guidelines/レビューガイドライン.md)
- **マージ後確認**: [`knowledge/guidelines/バージョン管理指針.md`](../knowledge/guidelines/バージョン管理指針.md)
- **次タスクの選定**: [`domain/実装計画.md`](../domain/実装計画.md)

---

**更新日**: 2025-01-08  
**バージョン**: 2.0.0 (Issue連携対応)  
**管理者**: 開発チーム
