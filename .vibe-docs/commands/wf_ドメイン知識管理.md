# ドメイン知識管理ワークフロー

## 概要

ドメイン知識の追加・更新からGitHub Issue作成までの標準的な手順を定義します。ビジネス要件やドメインルールの変更を適切に管理し、実装可能なタスクとして体系的にアウトプットします。

## 前提条件

- 新しいビジネス要件または既存要件の変更が発生
- ドメインエキスパートとの合意が取れている
- 変更の影響範囲が明確化されている

## 必要な参考資料

### 📋 ドメイン知識（必須）
- [`domain/business-rules.md`](../domain/business-rules.md) - 現在のビジネスルール
- [`domain/terminology.md`](../domain/terminology.md) - 用語定義・ドメイン概念  
- [`domain/user-stories/`](../domain/user-stories/) - 既存ユーザーストーリー
- [`domain/project-overview.md`](../domain/project-overview.md) - プロジェクト全体像

### 🏗️ 技術仕様（必須）
- [`spec/アーキテクチャ.md`](../spec/アーキテクチャ.md) - システムアーキテクチャ
- [`spec/API設計指針.md`](../spec/API設計指針.md) - API設計方針
- [`spec/データベース設計.md`](../spec/データベース設計.md) - データベース設計

### 🎯 管理指針（必須）
- [`knowledge/guidelines/ドメインバージョン管理指針.md`](../knowledge/guidelines/ドメインバージョン管理指針.md) - バージョン管理方針
- [`domain/versions/current.md`](../domain/versions/current.md) - 現在のドメイン状態
- [`domain/実装計画.md`](../domain/実装計画.md) - 既存実装計画

## ワークフロー手順

### Phase 1: ドメイン知識の分析・整理 🔍

#### 1.1 変更内容の分析

```markdown
変更分析チェックリスト：

**ビジネス要件の変更**
- [ ] 新しいビジネスルールの追加
- [ ] 既存ビジネスルールの変更・削除
- [ ] 新しい用語・概念の導入
- [ ] 既存用語の定義変更
- [ ] 新しいユーザーストーリーの追加
- [ ] 既存ユーザーストーリーの変更

**技術的影響の確認**
- [ ] データベーススキーマへの影響
- [ ] APIインターフェースへの影響
- [ ] 既存機能への影響
- [ ] セキュリティ要件への影響
```

#### 1.2 影響範囲の特定

```bash
# 関連ファイルの検索
grep -r "変更対象の用語" vibe-context/
grep -r "関連概念" vibe-context/

# 既存実装への影響確認
grep -r "該当機能" apps/ packages/
```

**影響範囲マップ作成:**
```markdown
## 影響範囲分析

### ドメイン知識への影響
- [ ] business-rules.md: [具体的な変更内容]
- [ ] terminology.md: [新規/変更用語]
- [ ] user-stories/: [該当ストーリー]

### 技術仕様への影響
- [ ] アーキテクチャ: [アーキテクチャ変更の必要性]
- [ ] データベース: [スキーマ変更の必要性]
- [ ] API: [インターフェース変更の必要性]

### 既存実装への影響
- [ ] 影響を受ける機能: [機能名一覧]
- [ ] 破壊的変更の有無: [Yes/No + 詳細]
- [ ] 後方互換性: [維持可能/要対応]
```

### Phase 2: ドメイン知識の更新 📝

#### 2.1 ビジネスルールの更新

```markdown
business-rules.md更新手順：

1. **既存ルールの確認**
   - 変更対象ルールの特定
   - 関連ルールとの整合性確認
   - 依存関係の洗い出し

2. **新規ルールの追加/変更**
   - ルール番号の割り当て
   - 明確で検証可能な表現
   - 例外条件の明記
   - 関連ルールとの関係性明記

3. **検証**
   - ビジネスエキスパートとの確認
   - 他ルールとの矛盾チェック
   - 実装可能性の確認
```

#### 2.2 用語定義の更新

```markdown
terminology.md更新手順：

1. **用語の整理**
   - [ ] 新規用語の定義追加
   - [ ] 既存用語の定義変更
   - [ ] 廃止用語のマーク
   - [ ] 同義語・関連語の整理

2. **一貫性の確保**
   - [ ] 他ドキュメントとの用語統一
   - [ ] 英語表記の統一
   - [ ] 略語・正式名称の整理

3. **文脈情報の追加**
   - [ ] 使用される場面の明記
   - [ ] 関連概念との関係性
   - [ ] 実装上の注意点
```

#### 2.3 ユーザーストーリーの更新

```markdown
user-stories更新手順：

1. **ストーリーの分類**
   - [ ] 新規ストーリー
   - [ ] 既存ストーリーの変更
   - [ ] 廃止ストーリー

2. **ストーリー作成/更新**
   - [ ] As a [ユーザー] I want [機能] so that [価値]
   - [ ] 受け入れ条件の明記
   - [ ] 優先度の設定
   - [ ] 依存関係の明記

3. **検証**
   - [ ] INVEST原則の確認（Independent, Negotiable, Valuable, Estimable, Small, Testable）
   - [ ] ビジネス価値の明確化
   - [ ] 実装可能性の確認
```

### Phase 3: バージョン管理・リビジョン更新 🔄

#### 3.1 リビジョン番号の更新

```markdown
domain/versions/current.md更新手順：

1. **リビジョン履歴の追加**
   ```markdown
   - **r[N+1]** (2025-MM-DD): [変更概要]
     - ビジネスルール: [変更内容]
     - 用語定義: [追加/変更用語]
     - ユーザーストーリー: [新規/変更ストーリー]
   ```

2. **進捗サマリーの更新**
   - 機能マップの更新
   - 完了状況の反映
   - 次期バージョン計画の調整

3. **実装ノートの更新**
   - 技術的制約の見直し
   - アーキテクチャ方針の調整
```

#### 3.2 実装計画の調整

```markdown
domain/実装計画.md更新手順：

1. **既存タスクの見直し**
   - [ ] 影響を受けるタスクの特定
   - [ ] 優先度の再評価
   - [ ] 工数見積もりの調整

2. **新規タスクの追加**
   - [ ] 新しい要件に対応するタスク
   - [ ] 既存機能の修正タスク
   - [ ] 移行・互換性対応タスク

3. **依存関係の更新**
   - [ ] タスク間の依存関係見直し
   - [ ] ブロッカーの解決
   - [ ] リリース計画の調整
```

### Phase 4: 技術仕様の検証・更新 🔧

#### 4.1 アーキテクチャへの影響確認

```markdown
spec/アーキテクチャ.md検証項目：

- [ ] レイヤー構成への影響
- [ ] モジュール分割への影響
- [ ] 外部システム連携への影響
- [ ] スケーラビリティへの影響
- [ ] セキュリティアーキテクチャへの影響
```

#### 4.2 データベース設計への影響確認

```markdown
spec/データベース設計.md検証項目：

- [ ] 新規テーブルの必要性
- [ ] 既存テーブルの変更必要性
- [ ] インデックス戦略の見直し
- [ ] データ移行の必要性
- [ ] パフォーマンスへの影響
```

#### 4.3 API設計への影響確認

```markdown
spec/API設計指針.md検証項目：

- [ ] 新規エンドポイントの必要性
- [ ] 既存エンドポイントの変更必要性
- [ ] 後方互換性の維持可能性
- [ ] バージョニング戦略の見直し
- [ ] セキュリティ要件の変更
```

### Phase 5: GitHub Issue生成・管理 📋

#### 5.1 Issueの分類・優先順位付け

```markdown
Issue分類：

**1. 緊急（High Priority）**
- [ ] セキュリティに関わる変更
- [ ] データ整合性に関わる変更
- [ ] 外部システム連携の破綻を防ぐ変更

**2. 重要（Medium Priority）**
- [ ] 新機能の実装
- [ ] 既存機能の重要な改善
- [ ] ユーザビリティの大幅向上

**3. 通常（Low Priority）**
- [ ] UI/UXの小幅改善
- [ ] 内部リファクタリング
- [ ] ドキュメント更新
```

#### 5.2 Issue作成

```bash
# Feature Issue作成例
gh issue create --title "feat: メール送信機能の認証方式強化" --body "$(cat <<'EOF'
## 概要
新しいビジネスルールに対応するため、メール送信機能の認証方式を強化します。

## 背景
- **ドメイン変更**: business-rules.md BR-012の追加
- **リビジョン**: r3で追加された要件
- **ユーザーストーリー**: notion-integration.md US-005

## 受け入れ条件
- [ ] 2要素認証の実装
- [ ] 既存認証との後方互換性確保
- [ ] セキュリティ監査ログの実装

## 技術仕様
- **影響範囲**: 認証システム、メール送信API
- **データベース**: auth_tokensテーブルの追加
- **API**: POST /api/auth/mfa エンドポイント追加

## 関連ドキュメント
- ビジネスルール: BR-012
- ユーザーストーリー: US-005
- アーキテクチャ: セキュリティアーキテクチャ 3.2節

## 見積もり
- **工数**: 5-8日
- **優先度**: High
- **リリース**: v0.3.0

## 依存関係
- Depends on: #[認証基盤Issue番号]
- Blocks: #[メール送信Issue番号]
EOF
)" --label "enhancement,security,high-priority" --milestone "v0.3.0"
```

#### 5.3 Issue間の関係性管理

```markdown
Issue関係性の設定：

1. **依存関係の設定**
   ```bash
   # 依存関係の記載例
   echo "Depends on: #123, #124" >> issue_body.md
   echo "Blocks: #126, #127" >> issue_body.md
   ```

2. **ラベルの統一**
   - `domain-change`: ドメイン知識変更由来
   - `breaking-change`: 破壊的変更
   - `migration-required`: データ移行必要
   - `security`: セキュリティ関連
   - `high-priority`, `medium-priority`, `low-priority`

3. **マイルストーンの設定**
   - バージョンリリースと連動
   - 四半期計画との整合性
```

### Phase 6: 実装準備・引き継ぎ 🎯

#### 6.1 実装チームへの引き継ぎ

```markdown
引き継ぎドキュメント作成：

## 変更概要
- **ドメイン変更**: [変更内容の要約]
- **影響範囲**: [システムへの影響]
- **実装期限**: [リリース予定]

## 重要な注意点
- **破壊的変更**: [有/無と詳細]
- **データ移行**: [必要性と手順]
- **テスト戦略**: [重点テスト項目]

## 参考資料
- [更新されたドメインドキュメント一覧]
- [関連GitHub Issues]
- [設計ドキュメント]
```

#### 6.2 ステークホルダーへの報告

```markdown
変更報告書：

## エグゼクティブサマリー
- **変更理由**: [ビジネス価値・必要性]
- **実装期間**: [開始-完了予定]
- **影響**: [ユーザー・システムへの影響]

## リスク・課題
- **技術的リスク**: [識別されたリスク]
- **スケジュールリスク**: [遅延要因]
- **軽減策**: [リスク対応策]

## 次のステップ
- [ ] 実装開始
- [ ] 進捗レポート（週次）
- [ ] ステークホルダー承認
```

## チェックポイント

### ✅ Phase 1 完了チェック
- [ ] 変更内容が明確に整理されている
- [ ] 影響範囲が適切に特定されている
- [ ] ステークホルダーの合意が得られている
- [ ] 必要な参考資料がすべて確認済み

### ✅ Phase 2 完了チェック
- [ ] business-rules.mdが適切に更新されている
- [ ] terminology.mdの一貫性が保たれている
- [ ] ユーザーストーリーがINVEST原則に準拠
- [ ] 他ドキュメントとの整合性が確保されている

### ✅ Phase 3 完了チェック
- [ ] リビジョン番号が適切に更新されている
- [ ] バージョン管理指針に従っている
- [ ] 実装計画が現実的に調整されている
- [ ] 依存関係が正しく管理されている

### ✅ Phase 4 完了チェック
- [ ] アーキテクチャへの影響が評価済み
- [ ] データベース設計が検証済み
- [ ] API設計への影響が確認済み
- [ ] 後方互換性が検討されている

### ✅ Phase 5 完了チェック
- [ ] 適切にラベル・優先度が設定されている
- [ ] Issue間の依存関係が正しく設定されている
- [ ] 受け入れ条件が明確に定義されている
- [ ] 見積もりが現実的である

### ✅ Phase 6 完了チェック
- [ ] 実装チームへの引き継ぎが完了
- [ ] ステークホルダーへの報告が完了
- [ ] 次フェーズの準備が整っている
- [ ] 進捗追跡の仕組みが設定されている

## 品質基準

### 📋 ドキュメント品質
- **一貫性**: 用語・形式の統一
- **完全性**: 必要情報の網羅
- **追跡可能性**: 変更履歴の記録
- **可読性**: 理解しやすい表現

### 🔍 分析品質
- **網羅性**: 影響範囲の完全な特定
- **正確性**: 影響度の適切な評価
- **実装可能性**: 現実的な計画
- **リスク管理**: 適切なリスク識別

### 📊 Issue品質
- **明確性**: 受け入れ条件の明確化
- **追跡可能性**: ドメイン変更との紐づけ
- **優先順位**: 適切な優先度設定
- **関係性**: 依存関係の正確な管理

## トラブルシューティング

### ❌ よくある問題と対処法

#### 1. ビジネスルールの矛盾が発見された場合
```
解決策: 
- business-rules.mdの全体レビュー
- ステークホルダーとの再確認
- 矛盾解決の優先順位決定
問い合わせ先: プロダクトオーナー・ビジネスアナリスト
```

#### 2. 技術的制約でドメイン要件が実現困難な場合
```
解決策:
- spec/アーキテクチャ.mdの制約確認
- 代替実装方法の検討
- 段階的実装の検討
問い合わせ先: アーキテクト・テックリード
```

#### 3. 既存システムへの影響が予想以上に大きい場合
```
解決策:
- 影響範囲の再評価
- 段階的移行計画の作成
- 後方互換性の確保
問い合わせ先: システムアーキテクト・インフラチーム
```

#### 4. Issue管理が複雑になった場合
```
解決策:
- Epic/Storyの階層化
- ラベル体系の見直し
- マイルストーンの細分化
- プロジェクトボードの活用
```

## 継続的改善

### 🔄 振り返り項目
```markdown
ワークフロー完了後の振り返り：

1. **プロセス効率性**
   - 各Phaseの所要時間は適切だったか？
   - ボトルネックはどこにあったか？

2. **品質**
   - ドキュメントの品質は期待通りだったか？
   - Issue設計は実装時に有効だったか？

3. **コミュニケーション**
   - ステークホルダーとの調整は円滑だったか？
   - 実装チームへの引き継ぎは効果的だったか？

4. **改善提案**
   - ワークフローの改善点は？
   - ツール・テンプレートの改善点は？
```

## 完了条件

### ✅ プロセス完了条件
- [ ] 全6Phaseが完了している
- [ ] 全チェックポイントが満たされている
- [ ] 品質基準をクリアしている
- [ ] ステークホルダー承認を得ている

### ✅ 成果物完了条件
- [ ] ドメインドキュメントが適切に更新されている
- [ ] GitHub Issuesが作成・管理されている
- [ ] 実装チームが作業開始可能な状態
- [ ] 進捗追跡の仕組みが整備されている

### ✅ 引き継ぎ完了条件
- [ ] 実装チームへの説明が完了
- [ ] 質問・疑問点が解決されている  
- [ ] 次回レビューのスケジュールが設定されている
- [ ] エスカレーション経路が確立されている

## 次のステップ

ドメイン知識管理完了後は以下のワークフローに移行：

- **実装開始**: [`wf_実装開始.md`](./wf_実装開始.md)
- **タスク実装**: [`wf_タスク実装.md`](./wf_タスク実装.md)
- **進捗管理**: [`domain/versions/current.md`](../domain/versions/current.md)の定期更新

---

**更新日**: 2025-01-08  
**バージョン**: 1.0.0  
**管理者**: プロダクト・開発チーム